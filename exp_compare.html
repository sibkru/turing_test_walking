<html>
  <head>
    <title>Movement Perception Experiment</title>
    <!-- <script src="render.js"></script> -->
    <script src="render_points.js"></script>
    <script src="webgl-utils.js"></script>
    <script src="gl-matrix.js"></script>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/perceptual-movement-prediction.js"></script>
      <script src="jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
     <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>
  <script>
    var langEng;
      
    function saveData(name, data){
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(JSON.stringify({filename: name, filedata: data}));
    }


    sona_subject_id = GetURLParameter('subject')
    if (!subject_id) {
	var subject_id = jsPsych.randomization.randomID(15);
    }
    
     // 'https://marburg-psychology.sona-systems.com/webstudy_credit.aspx?experiment_id=376&credit_token=a434dd35804f4ffebcee989f5ddbb6f6&survey_code=XXXX'
     // 'https://marburg-psychology.sona-systems.com/services/SonaAPI.svc/WebstudyCredit?experiment_id=376&credit_token=a434dd35804f4ffebcee989f5ddbb6f6&survey_code=XXXX'
    jsPsych.data.addProperties({
      subject: subject_id,
      sona: sona_subject_id
    });

    var timeline = [];

    var welcome = {
        // type: "html-keyboard-response",
        type: 'html-button-response',
        choices: ['English', 'Deutsch'], 
        stimulus: "<p>Welcome!<br> Please choose your language to start the experiment in the chosen language.</p><p>Willkommen!<br> Bitte wählen Sie eine Sprache um das Experiment in der ausgewählten Sprache zu starten</p>",
        on_finish: function(data) {
            // choosing language by deleting corresponding arrays in timeline
            if(data.button_pressed == 0){
                langEng = true;
            } else {
                langEng = false; 
            }}};
       
      
   
    var instructionsEng = {
        type: 'instructions',
        pages: [
            '<p>In this experiment, you have to compare two movements.</p><p></p> <p>For this you will see two movement sequences next to each other in a trial.</p><p>Please look at the fixation cross before every sequence.</p>',
            '<p>After each sequence you can choose which one appear <strong>natural</strong> for you by pressing the corresponding button.</p>',
            'Choose <strong>1</strong> for the <i>left sequence</i> and <strong>2</strong> for the <i>right sequence</i>.</p>',
            '<p>For learning purposes the first trial will be only for training.</p>'],
        show_clickable_nav: true
    };
    var instructionsGer = {
        type: 'instructions',
        pages: [
            '<p>In diesem Experiment vergleichen Sie zwei Bewegungen miteinander.</p><p></p><p>Sie werden in jedem Testdurchlauf  zwei Bewegungssequenzen nebeneinander sehen.</p><p>Schauen Sie bitte auf das Fixationskreuz vor jeder Sequenz.</p>',
            '<p>Sie können nach jeder Sequenz auswählen, welche der beiden Sequenzen für Sie <strong>natürlicher</strong> aussieht.</p> <p>Drücken Sie hierfür auf das entsprechende Klickfeld.</p>',
            '<p>Wählen Sie für die <i>linke Sequenz</i> die <strong>1</strong> und für die <i>rechte Sequenz</i> die <strong>2</strong> aus.</p>',
            'Zu Übungszwecken wird der erste Durchgang nur eine Übung sein.'],
        show_clickable_nav: true
    };
    
  var ifEng = {
    timeline: [instructionsEng],
    conditional_function: function(){
        if(langEng){
            return true;
        
        } else {
            return false;
        }
    }}
  var ifGer = {
    timeline: [instructionsGer],
    conditional_function: function(){
        if(!langEng){
            return true;
        
        } else {
            return false;
        }
    }}
    
    /*stimulus: function() {
            if(langEng){   
                return '<p>In this experiment, you have to compare two movements.</p><p></p> <p>For this you will see two movement sequences next to each other in a trial.</p><p>Please look at the fixation cross before every sequence</p><p>After each sequence you can choose which one appear <strong>natural</strong> for you by pressing the corresponding button.</p><p></p><p>The first trial will be only a training trial</p>';
                } else {
                return '<p>In diesem Experiment vergleichen Sie zwei Bewegungen miteinander.</p><p></p><p>Sie werden in jedem Testdurchlauf  zwei Bewegungssequenzen nebeneinander sehen.</p><p>Schauen Sie bitte auf das Fixationskreuz vor jeder Sequenz</p><p>Sie können nach jeder Sequenz auswählen, welche der beiden Sequenzen für Sie <strong>natürlich</strong> aussieht.</p> <p>Drücken Sie hierfür auf das entsprechende Klickfeld.</p><p>Der erste Durchgang wird ein Training sein</p>';
         }},
        choices: ['OK'], 
        post_trial_gap: 1000
    }  
    */

    
      
    
    var ready = {
        type: 'html-button-response',
        stimulus: function() {
            if(langEng){
                return '<p>Ready?</p>';
            } else {
                return '<p>Bereit?</p>';
            }
        },
        choices: ['OK!'],
		post_trial_gap: 1000
    }
  
    var fixation = {
        type: 'html-keyboard-response',
        stimulus: '<div style="font-size:60px;">+</div>',
        choices: jsPsych.NO_KEYS,
        trial_duration: 1000,
    }
    var answer = {
        type: 'html-button-response',                
        stimulus: function(){
            if(langEng){
                return '<p>Which sequence did you perceive as more natural?</p>';
            } else {
                return '<p>Welche Sequenz haben Sie als natürlicher empfunden?</p>';
            }},
        choices: ['1', '2'], //jsPsych.ALL_KEYS,
    }  
 
    
   
    
  
    var start = {
        type: 'html-button-response',                
        stimulus: function(){
            if(langEng){ 
                return '<p>We hope that you unterstood the instrunctions.</p>' + '<p>Please click the button if you are ready.</p>' + '<p>If not then please reload the page for a restart.</p>';
            } else {
                return '<p>Wir hoffen, dass Sie die Instruktionen verstanden haben.</p>' + '<p> Bitte drücken Sie auf das Klickfeld, wenn Sie bereit sind.</p>' + '</p>Falls nicht, aktualisieren Sie bitte die Internetseite neu.</p>'
            }},
        choices: ['Start'], 
    }
    
  
  


      

      
      
      
      
      
      
    
      
      
      
      
      
    jsPsych.init({
        timeline: [welcome, ifEng, ifGer, ready, fixation, answer, start],
        show_progress_bar: true,
        auto_update_progress_bar: true
    });
  </script>
</html>
